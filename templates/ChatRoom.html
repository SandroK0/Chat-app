{% extends 'base.html'%} {% block body %}
<link
  rel="stylesheet"
  href="{{url_for('static', filename='css/ChatRoom.css')}}"
/>
<div class="chat-cont">
  <h1>Chat Room</h1>
  <div class="message-container" id="message-container">
    {% for message in messages%}
    <p>{{message[1]}}:{{message[2]}}</p>
    {% endfor %}
  </div>
  <form method="POST" class="send-form" id="message-form">
    <input
      type="text"
      placeholder="Message"
      id="message-input"
      name="message"
    />
    <button type="submit">Send</button>
  </form>
  <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
  <script>
    const scrollableDiv = document.getElementById("message-container");

    function ScrollDown(){
      scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
    }

    window.onload = function () {
      ScrollDown()
    };

    scrollableDiv.addEventListener('DOMNodeInserted', ScrollDown)

    var socket = io();

    socket.on("connect", function () {
      console.log("Connected to server");
    });

    socket.on("disconnect", function () {
      console.log("Disconnected from server");
    });

    socket.on("message", function (data) {
      var messageContainer = document.getElementById("message-container");
      messageContainer.innerHTML +=
        "<p>" + data.author + ": " + data.message + "</p>";
    });

    document
      .getElementById("message-form")
      .addEventListener("submit", function (event) {
        event.preventDefault();
        var messageInput = document.getElementById("message-input");
        var message = messageInput.value.trim();

        if (message) {
          socket.emit("new_message", { message: message });
          messageInput.value = "";
        }
      });
  </script>
</div>
{% endblock %}
